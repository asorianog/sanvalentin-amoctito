<!doctype html>

<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta property="og:title" content="Holi! ‚ù§Ô∏è" />
  <meta property="og:description" content="Toca el coraz√≥n :3 ..." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://asorianog.github.io/sanvalentin-amoctito/" />
  <meta property="og:image" content="https://asorianog.github.io/sanvalentin-amoctito/preview.png" />
  <meta property="og:image:secure_url" content="https://asorianog.github.io/sanvalentin-amoctito/preview.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <style>
    :root{
      --bg1:#7a004f;
      --bg2:#ff2d8a;
      --card:#f3e6dc;
      --ink:#3a2a23;
      --muted:#6b4e44;
      --shadow: 0 18px 60px rgba(0,0,0,.35);
      --radius: 28px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; color:var(--ink); }

    body{
      background:
        radial-gradient(900px 900px at 20% 15%, rgba(255,255,255,.10), transparent 55%),
        radial-gradient(900px 900px at 80% 30%, rgba(255,255,255,.08), transparent 55%),
        linear-gradient(180deg, var(--bg2), var(--bg1));
      overflow:hidden;
    }

    .bg-hearts{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.30;
      filter: blur(.2px);
    }
    .bg-hearts span{
      position:absolute;
      font-size: clamp(18px, 3.5vw, 42px);
      animation: floatUp linear infinite;
      opacity:.55;
      transform: translate3d(0,0,0);
    }
    @keyframes floatUp{
      from{ transform: translateY(110vh) scale(.8); opacity:0; }
      10%{ opacity:.55; }
      to{ transform: translateY(-20vh) scale(1.15); opacity:0; }
    }

    .wrap{
      height:100%;
      display:grid;
      place-items:center;
      padding: 22px;
    }

    .card{
      width:min(720px, 96vw);
      aspect-ratio: 9 / 16;
      max-height: min(92vh, 980px);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: relative;
      overflow:hidden;
    }

    .inner{
      position:absolute; inset:0;
      padding: clamp(40px, 6vw, 70px) clamp(18px, 3.8vw, 34px);
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: clamp(10px, 3vw, 22px);
      align-items: center;
    }

    @media (max-width: 520px){
      .inner{
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr;
        align-items:start;
      }
    }

    .letter{
      margin-top: 50px;
      line-height:1.35;
      font-size: clamp(14px, 2.6vw, 18px);
      color: var(--muted);
      opacity: 0;
      transform: translateX(-14px);
      transition: opacity .7s ease, transform .7s ease;
    }
    .card.stageText .letter{
      opacity: 1;
      transform: translateX(0);
    }
    .letter h1{
      margin:0 0 10px 0;
      font-size: clamp(16px, 3.2vw, 22px);
      color: var(--ink);
      font-weight: 650;
    }

    .type{ min-height: 10lh; white-space: pre-wrap; }
    .cursor{
      display:inline-block;
      width:.6ch;
      animation: blink 1s steps(1) infinite;
      color: var(--ink);
      font-weight:700;
    }
    @keyframes blink{ 50%{ opacity:0; } }

    .treeBox{
      width:100%;
      height:100%;
      display:grid;
      place-items:center;
      position:relative;
    }
    canvas{
      width:100%;
      height:100%;
      max-width: 360px;
      max-height: 520px;
    }

    /* l√≠nea base */
    .ground{
      position:absolute;
      left: 8%;
      right: 8%;
      bottom: clamp(64px, 10vh, 92px);
      height: 2px;
      background: rgba(70,40,30,.5);
      border-radius: 99px;
    }

    .footer{
      position:absolute;
      left: clamp(18px, 3.8vw, 34px);
      right: clamp(18px, 3.8vw, 34px);
      bottom: clamp(16px, 3.2vw, 26px);
      display:flex;
      flex-direction:column;
      gap:6px;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity .7s ease, transform .7s ease;
    }
    .card.stageText .footer{
      opacity: 1;
      transform: translateY(0);
    }
    .footer .label{
      color: var(--muted);
      font-size: clamp(12px, 2.4vw, 15px);
    }
    .timer{
      display:flex;
      gap: clamp(10px, 2.6vw, 18px);
      flex-wrap: wrap;
      font-variant-numeric: tabular-nums;
      color: var(--ink);
      font-size: clamp(16px, 3.6vw, 22px);
      font-weight: 700;
    }
    .timer span small{
      font-weight: 600;
      color: var(--muted);
      font-size: .72em;
      margin-left: 4px;
    }

    .fall{
      position:absolute; inset:0;
      pointer-events:none;
      overflow:hidden;
      opacity: 0;
      transition: opacity .5s ease;
    }
    .card.stageText .fall{ opacity: 1; }
    .fall i{
      position:absolute;
      top:-10%;
      font-style:normal;
      animation: fall linear infinite;
      opacity:.75;
      will-change: transform, opacity;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.12));
    }
    @keyframes fall{
      from{ transform: translateY(-10vh) translateX(0) rotate(0deg) scale(.9); opacity:0; }
      10%{ opacity:.75; }
      to{ transform: translateY(120vh) translateX(20px) rotate(240deg) scale(1.1); opacity:0; }
    }

    .mark{
      position:absolute;
      top: 14px;
      left: 18px;
      font-size: 12px;
      color: rgba(0,0,0,.22);
      letter-spacing:.08em;
      text-transform: uppercase;
      user-select:none;
    }

    /* ===== Overlay inicio: coraz√≥n + Holi! ===== */
    .startOverlay{
      position:absolute; inset:0;
      display:grid;
      place-items:center;
      z-index: 50;
      cursor: pointer;
      background: radial-gradient(400px 320px at 50% 45%, rgba(255,255,255,.22), transparent 70%);
    }
    .card.started .startOverlay{
      opacity: 0;
      pointer-events:none;
      transition: opacity .45s ease;
    }
    .startBox{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 10px;
      padding: 14px 18px;
      border-radius: 18px;
      background: rgba(255,255,255,.28);
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 34px rgba(0,0,0,.12);
    }
    .holi{
      font-weight: 900;
      letter-spacing:.08em;
      font-size: 14px;
      color: rgba(58,42,35,.82);
    }
    .pulseHeart{
      font-size: 56px;
      animation: pulse 1.05s ease-in-out infinite;
      transform-origin:center;
    }
    @keyframes pulse{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.12); }
    }
  </style>
</head>
<body>

  <div class="bg-hearts" aria-hidden="true" id="bg"></div>

  <div class="wrap">
    <div class="card" id="card" role="img" aria-label="Tarjeta rom√°ntica con √°rbol en forma de coraz√≥n">
      <div class="mark">Para ti ‚ù§Ô∏è</div>
      <div class="mark"></div>
      <div class="fall" aria-hidden="true" id="fall"></div>

      <div class="inner">
        <section class="letter">
          <h1>Para el amor de mi vida:</h1>
          <div class="type" id="type"></div><span class="cursor">|</span>
        </section>

        <section class="treeBox">
          <canvas id="c" width="600" height="900"></canvas>
          <div class="ground"></div>
        </section>
      </div>

      <footer class="footer">
        <div class="label">Mi amor por ti comenz√≥ hace‚Ä¶</div>
        <div class="timer" id="timer"></div>
      </footer>

      <!-- overlay inicio -->
      <div class="startOverlay" id="start">
        <div class="startBox" aria-label="Toca el coraz√≥n">
          <div class="pulseHeart" id="startHeart">üíó</div>
          <div class="holi">Holi!</div>
        </div>
      </div>

    </div>
  </div>

<script>
/** =========================
 * CONFIG
 * ========================= */
const loveStart = new Date("2025-02-23T00:00:00");
const lines = [
  "Si pudiera elegir un lugar\nseguro, ser√≠a a tu lado.",
  "Cuanto m√°s tiempo estoy\ncontigo m√°s te amo.",
  "Gracias por existir.\nTe elijo hoy y siempre. ‚ù§Ô∏è"
];

/** Fondo corazones */
(function bgHearts(){
  const el = document.getElementById("bg");
  const hearts = ["üíó","üíû","üíñ","üíò","üíì","üíï"];
  const n = 18;
  for(let i=0;i<n;i++){
    const s = document.createElement("span");
    s.textContent = hearts[Math.floor(Math.random()*hearts.length)];
    s.style.left = (Math.random()*100) + "%";
    s.style.animationDuration = (10 + Math.random()*10) + "s";
    s.style.animationDelay = (-Math.random()*18) + "s";
    s.style.opacity = (0.25 + Math.random()*0.4).toFixed(2);
    el.appendChild(s);
  }
})();

/** Corazones cayendo dentro de la tarjeta */
(function fallingHearts(){
  const el = document.getElementById("fall");
  const hearts = ["üíó","üíû","üíñ","üíò","üíì","üíï"];
  const n = 16;
  for(let i=0;i<n;i++){
    const h = document.createElement("i");
    h.textContent = hearts[Math.floor(Math.random()*hearts.length)];
    h.style.left = (Math.random()*100) + "%";
    h.style.fontSize = (12 + Math.random()*18) + "px";
    h.style.animationDuration = (6 + Math.random()*7) + "s";
    h.style.animationDelay = (-Math.random()*10) + "s";
    el.appendChild(h);
  }
})();

/** Typewriter (se dispara al final) */
function startTypewriter(){
  const out = document.getElementById("type");
  const full = lines.join("\n\n");
  let i = 0;
  const speed = 18;
  function tick(){
    out.textContent = full.slice(0, i++);
    if(i <= full.length) requestAnimationFrame(() => setTimeout(tick, speed));
  }
  tick();
}

/** Timer */
function pad2(n){ return String(n).padStart(2,"0"); }
function renderTimer(){
  const now = new Date();
  const diff = Math.max(0, now - loveStart);

  const sec = Math.floor(diff/1000);
  const days = Math.floor(sec / 86400);
  const hours = Math.floor((sec % 86400) / 3600);
  const mins = Math.floor((sec % 3600) / 60);
  const secs = sec % 60;

  document.getElementById("timer").innerHTML = `
    <span>${days}<small>d√≠as</small></span>
    <span>${pad2(hours)}<small>horas</small></span>
    <span>${pad2(mins)}<small>minutos</small></span>
    <span>${pad2(secs)}<small>segundos</small></span>
  `;
}

/** =========================
 * Canvas: √°rbol coraz√≥n
 * ========================= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const W = canvas.width, H = canvas.height;

function heartPoint(t){
  const x = 16 * Math.pow(Math.sin(t),3);
  const y = 13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t);
  return {x, y};
}

// MISMO formato de coraz√≥n (no lo cambio)
function drawSmallHeart(x,y, r, rot, alpha, color){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(rot);
  ctx.globalAlpha = alpha;
  ctx.fillStyle = color;
  ctx.beginPath();
  const s = r;
  ctx.moveTo(0, -0.2*s);
  ctx.bezierCurveTo(0.9*s, -1.2*s, 2.2*s, 0.3*s, 0, 1.6*s);
  ctx.bezierCurveTo(-2.2*s, 0.3*s, -0.9*s, -1.2*s, 0, -0.2*s);
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}

function lerp(a,b,t){ return a + (b-a)*t; }
function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

const leafColors = ["#ff2b68","#ff4d7f","#ff6a92","#ff8cab","#ff1f4d","#ff3b30","#ff567a","#ff7aa7"];
const leaves = [];

function initLeavesMore(){
  leaves.length = 0;

  // Base del √°rbol (se mover√° a la derecha con treeShift)
  // Hacemos que el coraz√≥n ‚Äúcopa‚Äù sea denso como p√©talos
  const cx0 = W*0.55;
  const cy0 = H*0.36;

  const N = 1100; // <<< M√ÅS corazones (antes 520). Sube a 1400 si quieres m√°s.

  for(let i=0;i<N;i++){
    const t = Math.random() * Math.PI * 2;
    const p = heartPoint(t);

    // interior vs contorno (m√°s lleno al centro)
    const interior = Math.random() < 0.75;
    const rBias = interior ? Math.pow(Math.random(), 2.8) : (0.75 + Math.random()*0.35);

    const scale = 11 + Math.random()*9;
    const x0 = cx0 + (p.x*scale)*rBias;
    const y0 = cy0 - (p.y*scale)*rBias;

    const jitter = interior ? 14 : 18;
    const x = x0 + (Math.random()-0.5)*jitter;
    const y = y0 + (Math.random()-0.5)*jitter;

    leaves.push({
      x, y,
      r: 2.7 + Math.random()*5.8,
      rot: Math.random()*Math.PI*2,
      alpha: 0,
      targetA: 0.55 + Math.random()*0.40,
      color: leafColors[Math.floor(Math.random()*leafColors.length)],
      appearAt: Math.random()*2200, // relleno m√°s largo
    });
  }

  // Ordena por appearAt para que se ‚Äúpinte‚Äù mejor
  leaves.sort((a,b)=>a.appearAt-b.appearAt);
}
initLeavesMore();

let start = performance.now();

/* Estado de animaci√≥n */
let running = true;
let clicked = false;

let drop = null; // gota
let sprout = { progress: 0 }; // crecimiento 0..1
let treeShift = 0; // 0..1 (se mueve a la derecha)
let fillProgress = 0; // 0..1 (relleno corazones)

function drawDroplet(d){
  // gota sencilla
  ctx.save();
  ctx.globalAlpha = d.alpha;
  ctx.fillStyle = "#c11635";
  ctx.translate(d.x, d.y);
  ctx.scale(d.s, d.s);
  ctx.beginPath();
  ctx.moveTo(0, -10);
  ctx.quadraticCurveTo(8, -2, 0, 12);
  ctx.quadraticCurveTo(-8, -2, 0, -10);
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}

function drawTrunk(progress, shift01){
  // progress 0..1
  // shift01 0..1 (se va a la derecha)
  const baseY = H*0.76;
  const baseX = lerp(W*0.50, W*0.63, shift01); // se desplaza a la derecha
  const p = clamp(progress,0,1);

  // tronco ‚Äúcrece‚Äù (recortamos altura con p)
  const maxH = 360;
  const h = maxH * p;

  ctx.save();
  ctx.globalAlpha = 1;
  ctx.fillStyle = "#8a4a25";

  ctx.beginPath();
  ctx.moveTo(baseX-16, baseY);
  ctx.quadraticCurveTo(baseX-22, baseY-h*0.33, baseX-10, baseY-h*0.72);
  ctx.quadraticCurveTo(baseX-2,  baseY-h*0.86, baseX+18, baseY-h);
  ctx.quadraticCurveTo(baseX+10, baseY-h*0.62, baseX+26, baseY);
  ctx.closePath();
  ctx.fill();

  // ramas aparecen despu√©s
  const br = clamp((p-0.35)/0.65, 0, 1);
  ctx.strokeStyle = "#7a3f1f";
  ctx.lineCap = "round";

  ctx.globalAlpha = 0.9*br;
  ctx.lineWidth = 10;
  ctx.beginPath();
  ctx.moveTo(baseX+2, baseY-h*0.78);
  ctx.quadraticCurveTo(baseX+78, baseY-h*0.90, baseX+112, baseY-h*1.10);
  ctx.stroke();

  ctx.lineWidth = 8;
  ctx.beginPath();
  ctx.moveTo(baseX-2, baseY-h*0.70);
  ctx.quadraticCurveTo(baseX-68, baseY-h*0.82, baseX-98, baseY-h*1.02);
  ctx.stroke();

  ctx.lineWidth = 6;
  ctx.beginPath();
  ctx.moveTo(baseX+22, baseY-h*0.96);
  ctx.quadraticCurveTo(baseX+70, baseY-h*1.05, baseX+90, baseY-h*1.18);
  ctx.stroke();

  ctx.restore();

  return { baseX, baseY, h };
}

function frame(now){
  if(!running) return;
  const t = now - start;

  ctx.clearRect(0,0,W,H);

  // Si a√∫n no han hecho click: dibuja ‚Äúcoraz√≥n inicio‚Äù dentro del canvas como referencia
  // (la UI del overlay est√° en HTML, pero aqu√≠ hacemos la gota despu√©s)
  if(clicked){
    // 1) gota cae
    if(drop){
      drop.vy += 0.0018 * (now - drop.last);
      drop.y += drop.vy * (now - drop.last);
      drop.alpha = Math.max(0, drop.alpha - 0.00055*(now - drop.last));
      drop.last = now;
      drawDroplet(drop);

      // cuando llega al suelo, inicia brote
      const groundY = H*0.72;
      if(drop.y >= groundY || drop.alpha <= 0.01){
        drop = null;
      }
    }

    // 2) √°rbol crece lentamente (de la semilla)
    // arranca cuando no hay gota
    if(!drop){
      // crecimiento lento
      sprout.progress = clamp(sprout.progress + 0.0012*(now - prevNow), 0, 1);

      // se va desplazando a la derecha en paralelo (m√°s tarde)
      const shiftTarget = clamp((sprout.progress - 0.25)/0.75, 0, 1);
      treeShift = lerp(treeShift, shiftTarget, 0.06);

      const trunkInfo = drawTrunk(sprout.progress, treeShift);

      // 3) relleno corazones (solo cuando hay tronco suficiente)
      const fillTarget = clamp((sprout.progress - 0.32)/0.68, 0, 1);
      fillProgress = Math.max(fillProgress, fillTarget);

      // centro de la copa se mueve con el tronco
      const canopyCx = trunkInfo.baseX + 2;
      const canopyCy = (H*0.36) - trunkInfo.h*0.20;

      // pintar corazones progresivamente
      const fillTimeMs = 3600; // lo tarda en llenarse
      const fillMs = fillProgress * fillTimeMs;

      for(const leaf of leaves){
        if(leaf.appearAt <= fillMs){
          leaf.alpha = Math.min(leaf.targetA, leaf.alpha + 0.016);
        }
        // aplicar desplazamiento del √°rbol a las hojas
        const dx = canopyCx - (W*0.55);
        const dy = canopyCy - (H*0.36);

        drawSmallHeart(leaf.x + dx, leaf.y + dy, leaf.r, leaf.rot, leaf.alpha, leaf.color);
      }

      // cuando ya est√° completo, mostramos texto/timer/lluvia
      if(sprout.progress > 0.97){
        document.getElementById("card").classList.add("stageText");
      }
    }
  }

  prevNow = now;
  requestAnimationFrame(frame);
}

let prevNow = performance.now();
requestAnimationFrame(frame);

/** Timer empieza pero solo se ver√° al final con stageText */
renderTimer();
setInterval(renderTimer, 1000);

/** Overlay click */
const cardEl = document.getElementById("card");
const startEl = document.getElementById("start");

function startSequence(){
  if(clicked) return;
  clicked = true;
  cardEl.classList.add("started");

  // crear gota desde el centro (posici√≥n visual del coraz√≥n overlay)
  drop = {
    x: W*0.52,
    y: H*0.22,
    vy: 0.0,
    alpha: 1.0,
    s: 1.0,
    last: performance.now()
  };

  // al final: typewriter
  // (lo arrancamos cuando se active stageText)
  const obs = new MutationObserver(()=>{
    if(cardEl.classList.contains("stageText")){
      obs.disconnect();
      startTypewriter();
    }
  });
  obs.observe(cardEl, {attributes:true});
}

startEl.addEventListener("click", startSequence);
startEl.addEventListener("touchstart", (e)=>{ e.preventDefault(); startSequence(); }, {passive:false});
</script>
</body>
</html>
